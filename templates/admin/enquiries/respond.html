<!-- templates/admin/enquiries/respond.html -->
{% extends 'admin/base.html' %}

{% block admin_title %}Respond to Enquiry - {{ enquiry.enquiry_id }}{% endblock %}
{% block page_title %}Respond to Enquiry{% endblock %}

{% block admin_content %}
<!-- Back Button -->
<div class="mb-3">
    <a href="{% url 'core:admin_enquiry_detail' enquiry.id %}" class="btn btn-outline-secondary">
        <i class="fas fa-arrow-left me-2"></i>Back to Details
    </a>
</div>

<!-- Status Banner -->
<div class="status-banner">
    <div class="status-banner-title">Respond to: {{ enquiry.subject|default:"No Subject" }}</div>
    <div class="status-banner-meta">
        <span class="meta-item">
            <i class="fas fa-hashtag"></i>{{ enquiry.enquiry_id }}
        </span>
        <span class="meta-item">
            <i class="fas fa-user"></i>{{ enquiry.first_name }} {{ enquiry.last_name }}
        </span>
        <span class="meta-item">
            <i class="fas fa-calendar"></i>{{ enquiry.created_at|date:"M d, Y" }}
        </span>
    </div>
</div>

<div class="row">
    <!-- Left Column - Response Form -->
    <div class="col-lg-8">
        <!-- Original Message -->
        <div class="detail-card">
            <div class="card-header-collapsible" data-bs-toggle="collapse" data-bs-target="#originalMessage">
                <h3 class="card-header-title">
                    <i class="fas fa-envelope-open-text"></i>
                    Original Message
                </h3>
                <i class="fas fa-chevron-down collapse-icon"></i>
            </div>
            <div class="collapse show" id="originalMessage">
                <div class="card-body-content">
                    <div class="original-message">
                        <div class="message-header">
                            <div class="customer-info">
                                <div class="customer-avatar">
                                    {{ enquiry.first_name|first|upper }}{{ enquiry.last_name|first|upper }}
                                </div>
                                <div>
                                    <div class="customer-name">{{ enquiry.first_name }} {{ enquiry.last_name }}</div>
                                    <div class="customer-email">{{ enquiry.business_email }}</div>
                                </div>
                            </div>
                            <div class="message-time">
                                {{ enquiry.created_at|date:"M d, Y h:i A" }}
                            </div>
                        </div>
                        <div class="message-content">
                            {{ enquiry.message|default:"No message provided"|linebreaksbr }}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Response Form -->
        <div class="detail-card">
            <div class="card-header-collapsible" data-bs-toggle="collapse" data-bs-target="#responseForm">
                <h3 class="card-header-title">
                    <i class="fas fa-reply"></i>
                    Your Response
                </h3>
                <i class="fas fa-chevron-down collapse-icon"></i>
            </div>
            <div class="collapse show" id="responseForm">
                <div class="card-body-content">
                    <form method="post" id="enquiryResponseForm">
                        {% csrf_token %}
                        
                        <!-- Editor Toolbar -->
                        <div class="editor-toolbar">
                            <button type="button" class="editor-btn" onclick="insertBulletList()" title="Bullet List">
                                <i class="fas fa-list-ul"></i>
                            </button>
                            <button type="button" class="editor-btn" onclick="insertNumberedList()" title="Numbered List">
                                <i class="fas fa-list-ol"></i>
                            </button>
                            <button type="button" class="editor-btn" onclick="insertSignature()" title="Insert Signature">
                                <i class="fas fa-signature"></i>
                            </button>
                            <button type="button" class="editor-btn" onclick="saveDraft()" title="Save Draft">
                                <i class="fas fa-save"></i> Save Draft
                            </button>
                        </div>

                        <!-- Response Textarea -->
                        <textarea 
                            class="editor-textarea" 
                            id="responseText" 
                            name="response_text" 
                            placeholder="Type your response here..."
                            required></textarea>
                        
                        <div class="character-count">
                            <span id="charCount">0</span> characters
                        </div>

                        <!-- Options -->
                        <div class="response-options">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="sendEmail" name="send_email" checked>
                                <label class="form-check-label" for="sendEmail">
                                    <strong>Send Email Notification</strong>
                                    <small class="d-block text-muted">Customer will receive this response via email</small>
                                </label>
                            </div>
                            
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="internalNote" name="is_internal_note">
                                <label class="form-check-label" for="internalNote">
                                    <strong>Internal Note</strong>
                                    <small class="d-block text-muted">Only visible to team members</small>
                                </label>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="form-actions">
                            <a href="{% url 'core:admin_enquiry_detail' enquiry.id %}" class="btn btn-secondary">
                                <i class="fas fa-times me-2"></i>Cancel
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-paper-plane me-2"></i>Send Response
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Previous Responses -->
        {% if previous_responses %}
        <div class="detail-card">
            <div class="card-header-collapsible" data-bs-toggle="collapse" data-bs-target="#previousResponses">
                <h3 class="card-header-title">
                    <i class="fas fa-history"></i>
                    Previous Responses
                    <span class="badge bg-secondary ms-2">{{ previous_responses|length }}</span>
                </h3>
                <i class="fas fa-chevron-down collapse-icon"></i>
            </div>
            <div class="collapse show" id="previousResponses">
                <div class="card-body-content">
                    {% for response in previous_responses %}
                    <div class="response-item {% if response.is_internal_note %}internal-note{% endif %}">
                        <div class="response-header">
                            <div class="response-author">
                                <i class="fas fa-user-circle me-1"></i>
                                {{ response.responded_by.get_full_name }}
                                {% if response.is_internal_note %}
                                    <span class="badge bg-warning ms-2">Internal</span>
                                {% endif %}
                            </div>
                            <div class="response-time">
                                {{ response.created_at|date:"M d, Y h:i A" }}
                            </div>
                        </div>
                        <div class="response-text">
                            {{ response.response_text|linebreaksbr }}
                        </div>
                    </div>
                    {% if not forloop.last %}
                    <hr class="response-divider">
                    {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Right Column - Quick Templates -->
    <div class="col-lg-4">
        <div class="detail-card">
            <div class="card-header-collapsible" data-bs-toggle="collapse" data-bs-target="#templates">
                <h3 class="card-header-title">
                    <i class="fas fa-file-alt"></i>
                    Quick Templates
                </h3>
                <i class="fas fa-chevron-down collapse-icon"></i>
            </div>
            <div class="collapse show" id="templates">
                <div class="card-body-content">
                    <div class="template-list">
                        <div class="template-item" onclick="useTemplate('acknowledgment')">
                            <div class="template-title">
                                <i class="fas fa-check-circle"></i>
                                Acknowledgment
                            </div>
                            <div class="template-preview">
                                Thank you for reaching out...
                            </div>
                        </div>
                        
                        <div class="template-item" onclick="useTemplate('information')">
                            <div class="template-title">
                                <i class="fas fa-question-circle"></i>
                                Information Request
                            </div>
                            <div class="template-preview">
                                To better assist you...
                            </div>
                        </div>
                        
                        <div class="template-item" onclick="useTemplate('schedule')">
                            <div class="template-title">
                                <i class="fas fa-calendar-check"></i>
                                Schedule Meeting
                            </div>
                            <div class="template-preview">
                                I would be happy to discuss...
                            </div>
                        </div>
                        
                        <div class="template-item" onclick="useTemplate('closing')">
                            <div class="template-title">
                                <i class="fas fa-handshake"></i>
                                Closing Response
                            </div>
                            <div class="template-preview">
                                Thank you for your interest...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Info -->
        <div class="detail-card">
            <div class="card-header-collapsible" data-bs-toggle="collapse" data-bs-target="#quickInfo">
                <h3 class="card-header-title">
                    <i class="fas fa-info-circle"></i>
                    Enquiry Info
                </h3>
                <i class="fas fa-chevron-down collapse-icon"></i>
            </div>
            <div class="collapse show" id="quickInfo">
                <div class="card-body-content">
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Status</div>
                            <div class="info-value">
                                <span class="badge bg-warning">{{ enquiry.get_status_display }}</span>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Priority</div>
                            <div class="info-value">
                                <span class="badge bg-info">{{ enquiry.get_priority_display }}</span>
                            </div>
                        </div>
                        {% if enquiry.category %}
                        <div class="info-item">
                            <div class="info-label">Category</div>
                            <div class="info-value">{{ enquiry.category.name }}</div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* ========== FONT FAMILY - ALIGNED WITH BASE.HTML ========== */
    * {
        font-family: var(--primary-font);
    }
    
    /* ========== STATUS BANNER ========== */
    .status-banner {
        background: var(--primary-color);
        color: white;
        padding: 1.25rem var(--spacing-lg);
        border-radius: var(--radius-xl);
        margin-bottom: var(--spacing-lg);
    }

    .status-banner-title {
        font-size: var(--font-2xl);
        font-weight: 600;
        margin-bottom: var(--spacing-sm);
        font-family: var(--heading-font);
    }

    .status-banner-meta {
        display: flex;
        flex-wrap: wrap;
        gap: var(--spacing-md);
        font-size: var(--font-md);
        opacity: 0.95;
        font-family: var(--primary-font);
    }

    .meta-item {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
    }

    /* ========== DETAIL CARDS ========== */
    .detail-card {
        background: white;
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-md);
        margin-bottom: var(--spacing-lg);
        overflow: hidden;
        border: 1px solid var(--gray-200);
    }

    .card-header-collapsible {
        background: var(--light-color);
        padding: var(--spacing-md) 1.25rem;
        border-bottom: 1px solid var(--gray-200);
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: all var(--transition-normal) ease;
        user-select: none;
    }

    .card-header-collapsible:hover {
        background: var(--gray-200);
    }

    .card-header-collapsible.collapsed {
        border-bottom: none;
    }

    .card-header-title {
        font-size: var(--font-2xl);
        font-weight: 600;
        color: var(--dark-color);
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin: 0;
        font-family: var(--heading-font);
    }

    .card-header-title i {
        color: var(--primary-color);
    }

    .collapse-icon {
        color: var(--gray-600);
        transition: transform var(--transition-normal) ease;
        font-size: var(--font-xl);
    }

    .card-header-collapsible:not(.collapsed) .collapse-icon {
        transform: rotate(180deg);
    }

    .card-body-content {
        padding: 1.25rem;
    }

    /* ========== ORIGINAL MESSAGE ========== */
    .original-message {
        background: var(--light-color);
        border-left: 4px solid var(--primary-color);
        border-radius: var(--radius-md);
        padding: 1.25rem;
    }

    .message-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-md);
        padding-bottom: 0.75rem;
        border-bottom: 1px solid var(--gray-200);
        flex-wrap: wrap;
        gap: var(--spacing-md);
    }

    .customer-info {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
    }

    .customer-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: var(--primary-color);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: var(--font-3xl);
        flex-shrink: 0;
        font-family: var(--primary-font);
    }

    .customer-name {
        font-weight: 600;
        color: var(--dark-color);
        font-size: var(--font-xl);
        font-family: var(--heading-font);
    }

    .customer-email {
        font-size: var(--font-sm);
        color: var(--gray-600);
        font-family: var(--primary-font);
    }

    .message-time {
        font-size: var(--font-sm);
        color: var(--gray-600);
        font-family: var(--primary-font);
    }

    .message-content {
        color: var(--gray-700);
        line-height: 1.7;
        font-size: var(--font-md);
        font-family: var(--primary-font);
    }

    /* ========== EDITOR ========== */
    .editor-toolbar {
        background: var(--light-color);
        border: 2px solid var(--gray-200);
        border-bottom: none;
        border-radius: var(--radius-md) var(--radius-md) 0 0;
        padding: 0.75rem;
        display: flex;
        gap: var(--spacing-sm);
        flex-wrap: wrap;
    }

    .editor-btn {
        background: white;
        border: 1px solid var(--gray-300);
        border-radius: var(--radius-md);
        padding: var(--spacing-sm) 0.75rem;
        cursor: pointer;
        transition: all var(--transition-fast) ease;
        font-size: var(--font-sm);
        color: var(--gray-600);
        font-family: var(--primary-font);
    }

    .editor-btn:hover {
        background: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
    }

    .editor-textarea {
        width: 100%;
        min-height: 300px;
        padding: var(--spacing-md);
        border: 2px solid var(--gray-200);
        border-radius: 0 0 var(--radius-md) var(--radius-md);
        resize: vertical;
        font-size: var(--font-base);
        line-height: 1.6;
        font-family: var(--primary-font);
    }

    .editor-textarea:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(8, 127, 194, 0.1);
    }

    .character-count {
        text-align: right;
        font-size: var(--font-sm);
        color: var(--gray-600);
        margin-top: var(--spacing-sm);
        margin-bottom: var(--spacing-md);
        font-family: var(--primary-font);
    }

    /* ========== RESPONSE OPTIONS ========== */
    .response-options {
        background: var(--light-color);
        padding: 1.25rem;
        border-radius: var(--radius-md);
        margin-bottom: var(--spacing-lg);
    }

    .response-options .form-check {
        margin-bottom: var(--spacing-md);
    }

    .response-options .form-check:last-child {
        margin-bottom: 0;
    }

    .form-check-input:checked {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
    }

    .form-check-input:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.2rem rgba(8, 127, 194, 0.25);
    }

    .form-check-label {
        font-size: var(--font-md);
        font-family: var(--primary-font);
    }

    .form-check-label strong {
        font-weight: 600;
    }

    .form-check-label small {
        font-size: var(--font-sm);
    }

    /* ========== FORM ACTIONS ========== */
    .form-actions {
        display: flex;
        gap: var(--spacing-md);
        justify-content: flex-end;
    }

    /* ========== RESPONSE ITEMS ========== */
    .response-item {
        padding: var(--spacing-md);
        border-radius: var(--radius-md);
        background: var(--light-color);
        margin-bottom: var(--spacing-md);
    }

    .response-item:last-child {
        margin-bottom: 0;
    }

    .response-item.internal-note {
        background: #fff3cd;
        border-left: 4px solid var(--warning-color);
    }

    .response-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.75rem;
        flex-wrap: wrap;
        gap: var(--spacing-sm);
    }

    .response-author {
        font-weight: 600;
        color: var(--dark-color);
        font-size: var(--font-md);
        font-family: var(--primary-font);
    }

    .response-time {
        font-size: var(--font-sm);
        color: var(--gray-600);
        font-family: var(--primary-font);
    }

    .response-text {
        font-size: var(--font-md);
        line-height: 1.6;
        color: var(--gray-700);
        font-family: var(--primary-font);
    }

    .response-divider {
        margin: var(--spacing-md) 0;
        border-color: var(--gray-200);
    }

    /* ========== TEMPLATES ========== */
    .template-list {
        display: grid;
        gap: 0.75rem;
    }

    .template-item {
        background: var(--light-color);
        padding: var(--spacing-md);
        border-radius: var(--radius-md);
        cursor: pointer;
        transition: all var(--transition-normal) ease;
        border: 2px solid var(--gray-200);
    }

    .template-item:hover {
        background: var(--gray-200);
        border-color: var(--primary-color);
        transform: translateX(5px);
    }

    .template-item.selected {
        background: #e7f3ff;
        border-color: var(--primary-color);
    }

    .template-title {
        font-weight: 600;
        color: var(--dark-color);
        margin-bottom: var(--spacing-sm);
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        font-size: var(--font-md);
        font-family: var(--heading-font);
    }

    .template-title i {
        color: var(--primary-color);
    }

    .template-preview {
        font-size: var(--font-sm);
        color: var(--gray-600);
        font-family: var(--primary-font);
    }

    /* ========== INFO GRID ========== */
    .info-grid {
        display: grid;
        gap: var(--spacing-md);
    }

    .info-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem;
        background: var(--light-color);
        border-radius: var(--radius-md);
    }

    .info-label {
        font-size: var(--font-sm);
        font-weight: 500;
        color: var(--gray-600);
        font-family: var(--primary-font);
    }

    .info-value {
        font-size: var(--font-md);
        color: var(--dark-color);
        font-weight: 500;
        font-family: var(--primary-font);
    }

    /* ========== BADGE STYLING ========== */
    .badge {
        font-family: var(--primary-font);
    }

    /* ========== RESPONSIVE DESIGN ========== */
    
    /* Tablet & Below (max 1024px) */
    @media (max-width: 1024px) {
        .status-banner-title {
            font-size: var(--font-xl);
        }
        
        .card-header-title {
            font-size: var(--font-xl);
        }
    }
    
    /* Tablet (max 991.98px) */
    @media (max-width: 991.98px) {
        .form-actions {
            flex-direction: column;
        }

        .form-actions .btn {
            width: 100%;
        }
    }

    /* Mobile (max 768px) */
    @media (max-width: 768px) {
        .status-banner {
            padding: var(--spacing-md);
        }
        
        .status-banner-title {
            font-size: var(--font-lg);
        }

        .status-banner-meta {
            font-size: var(--font-sm);
        }

        .message-header {
            flex-direction: column;
            align-items: flex-start;
        }

        .editor-toolbar {
            gap: var(--spacing-xs);
        }

        .editor-btn {
            padding: 0.375rem var(--spacing-sm);
            font-size: var(--font-sm);
        }
        
        .card-body-content {
            padding: var(--spacing-md);
        }
        
        .card-header-collapsible {
            padding: 0.875rem var(--spacing-md);
        }
        
        .card-header-title {
            font-size: var(--font-lg);
        }
        
        .customer-name {
            font-size: var(--font-lg);
        }
        
        .customer-avatar {
            width: 45px;
            height: 45px;
            font-size: var(--font-2xl);
        }
    }
    
    /* Mobile Small (max 575px) */
    @media (max-width: 575px) {
        .status-banner {
            padding: 0.875rem;
        }
        
        .status-banner-title {
            font-size: var(--font-md);
        }
        
        .status-banner-meta {
            font-size: var(--font-xs);
            flex-direction: column;
            gap: var(--spacing-xs);
        }
        
        .card-body-content {
            padding: 0.875rem;
        }
        
        .card-header-collapsible {
            padding: 0.75rem 0.875rem;
        }
        
        .card-header-title {
            font-size: var(--font-md);
        }
        
        .customer-avatar {
            width: 40px;
            height: 40px;
            font-size: var(--font-xl);
        }
        
        .editor-btn {
            padding: 0.25rem 0.375rem;
            font-size: var(--font-xs);
        }
        
        .template-item {
            padding: 0.875rem;
        }
    }
    
    /* Mobile Extra Small (max 479px) */
    @media (max-width: 479px) {
        .status-banner {
            padding: 0.75rem;
        }
        
        .card-body-content {
            padding: 0.75rem;
        }
        
        .card-header-collapsible {
            padding: 0.625rem 0.75rem;
        }
    }
</style>
{% endblock %}

{% block admin_extra_js %}
<script>
// Character counter
const responseText = document.getElementById('responseText');
const charCount = document.getElementById('charCount');

responseText.addEventListener('input', function() {
    charCount.textContent = this.value.length;
});

charCount.textContent = responseText.value.length;

// Internal note toggle
document.getElementById('internalNote').addEventListener('change', function() {
    const sendEmail = document.getElementById('sendEmail');
    
    if (this.checked) {
        sendEmail.checked = false;
        sendEmail.disabled = true;
    } else {
        sendEmail.disabled = false;
        sendEmail.checked = true;
    }
});

// Text formatting
function insertBulletList() {
    insertAtCursor(responseText, '\n• Point 1\n• Point 2\n• Point 3\n');
}

function insertNumberedList() {
    insertAtCursor(responseText, '\n1. Point 1\n2. Point 2\n3. Point 3\n');
}

function insertSignature() {
    const signature = `\n\nBest regards,\n{{ request.user.get_full_name|default:"Support Team" }}\n{{ request.user.email }}`;
    insertAtCursor(responseText, signature);
}

function insertAtCursor(textarea, text) {
    const startPos = textarea.selectionStart;
    const endPos = textarea.selectionEnd;
    
    textarea.value = textarea.value.substring(0, startPos) + text + textarea.value.substring(endPos);
    textarea.selectionStart = startPos + text.length;
    textarea.selectionEnd = startPos + text.length;
    textarea.focus();
    charCount.textContent = textarea.value.length;
}

// Templates
const templates = {
    acknowledgment: `Dear {{ enquiry.first_name }},\n\nThank you for reaching out to us regarding {{ enquiry.subject|default:"your enquiry" }}.\n\nWe have received your message and appreciate your interest in our services. Our team is currently reviewing your enquiry and will provide you with a comprehensive response shortly.\n\nWe typically respond within 24-48 business hours.\n\nThank you for your patience.\n\nBest regards,\n{{ request.user.get_full_name|default:"Support Team" }}`,
    
    information: `Dear {{ enquiry.first_name }},\n\nThank you for your enquiry about {{ enquiry.subject|default:"our services" }}.\n\nTo better assist you, could you please provide:\n\n1. Specific information needed\n2. Timeline or deadline\n3. Budget range\n4. Any specific requirements\n\nOnce we have this information, we'll provide you with a tailored solution.\n\nBest regards,\n{{ request.user.get_full_name|default:"Support Team" }}`,
    
    schedule: `Dear {{ enquiry.first_name }},\n\nThank you for your interest in {{ enquiry.subject|default:"our services" }}.\n\nI would be delighted to discuss this further. Please let me know your availability and I will arrange a suitable time for us to connect.\n\nLooking forward to speaking with you.\n\nBest regards,\n{{ request.user.get_full_name|default:"Support Team" }}`,
    
    closing: `Dear {{ enquiry.first_name }},\n\nThank you for your enquiry regarding {{ enquiry.subject|default:"our services" }}.\n\nI hope the information provided has been helpful. We're committed to providing excellent service and support.\n\nIf you have any further questions, please don't hesitate to reach out.\n\nThank you for considering our services.\n\nBest regards,\n{{ request.user.get_full_name|default:"Support Team" }}`
};

function useTemplate(type) {
    if (templates[type]) {
        responseText.value = templates[type];
        charCount.textContent = templates[type].length;
        
        document.querySelectorAll('.template-item').forEach(item => {
            item.classList.remove('selected');
        });
        event.target.closest('.template-item').classList.add('selected');
    }
}

// Draft saving
function saveDraft() {
    localStorage.setItem('enquiry_response_draft_{{ enquiry.id }}', responseText.value);
    alert('✅ Draft saved successfully!');
}

// Load draft
window.addEventListener('load', function() {
    const draft = localStorage.getItem('enquiry_response_draft_{{ enquiry.id }}');
    if (draft && confirm('A draft response was found. Load it?')) {
        responseText.value = draft;
        charCount.textContent = draft.length;
    }
});

// Form submit
document.getElementById('enquiryResponseForm').addEventListener('submit', function(e) {
    if (!responseText.value.trim()) {
        e.preventDefault();
        alert('⚠️ Please enter a response message.');
        return false;
    }
    
    localStorage.removeItem('enquiry_response_draft_{{ enquiry.id }}');
    
    const submitBtn = this.querySelector('button[type="submit"]');
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Sending...';
    submitBtn.disabled = true;
});
</script>
{% endblock %}