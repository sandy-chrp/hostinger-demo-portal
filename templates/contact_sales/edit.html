<!-- templates/admin/contact_sales/edit.html -->
{% extends 'admin/base.html' %}
{% load static %}
{% load permission_tags %}

{% block admin_title %}Edit Contact Message{% endblock %}

{% block page_title %}
<i class="fas fa-edit"></i>
Edit Contact Message
{% endblock %}

{% block admin_content %}
<div class="row">
    <div class="col-lg-8 mx-auto">
        <div class="admin-card">
            <div class="admin-card-header">
                <h5 class="admin-card-title mb-0">
                    <i class="fas fa-edit"></i>
                    Edit Contact Sales Message
                </h5>
            </div>
            <div class="admin-card-body">
                <form method="post" action="">
                    {% csrf_token %}

                    <!-- Contact Information Section -->
                    <h6 class="border-bottom pb-2 mb-3">
                        <i class="fas fa-user text-primary me-2"></i>
                        Contact Information
                    </h6>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="name" class="form-label fw-semibold">
                                Full Name <span class="text-danger">*</span>
                            </label>
                            <input type="text" 
                                   class="form-control" 
                                   id="name" 
                                   name="name" 
                                   value="{{ contact.name }}" 
                                   required>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label for="email" class="form-label fw-semibold">
                                Email Address <span class="text-danger">*</span>
                            </label>
                            <input type="email" 
                                   class="form-control" 
                                   id="email" 
                                   name="email" 
                                   value="{{ contact.email }}" 
                                   required>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="phone" class="form-label fw-semibold">Phone Number</label>
                            <input type="tel" 
                                   class="form-control" 
                                   id="phone" 
                                   name="phone" 
                                   value="{{ contact.phone|default:'' }}">
                        </div>

                        <div class="col-md-6 mb-3">
                            <label for="company" class="form-label fw-semibold">Company Name</label>
                            <input type="text" 
                                   class="form-control" 
                                   id="company" 
                                   name="company" 
                                   value="{{ contact.company|default:'' }}">
                        </div>
                    </div>

                    <!-- Message Section -->
                    <h6 class="border-bottom pb-2 mb-3 mt-4">
                        <i class="fas fa-envelope text-primary me-2"></i>
                        Message Details
                    </h6>

                    <div class="mb-3">
                        <label for="subject" class="form-label fw-semibold">
                            Subject <span class="text-danger">*</span>
                        </label>
                        <input type="text" 
                               class="form-control" 
                               id="subject" 
                               name="subject" 
                               value="{{ contact.subject }}" 
                               required>
                    </div>

                    <div class="mb-3">
                        <label for="message" class="form-label fw-semibold">
                            Message <span class="text-danger">*</span>
                        </label>
                        <textarea class="form-control" 
                                  id="message" 
                                  name="message" 
                                  rows="8" 
                                  required>{{ contact.message }}</textarea>
                    </div>

                    <!-- Admin Response Section -->
                    <h6 class="border-bottom pb-2 mb-3 mt-4">
                        <i class="fas fa-reply text-primary me-2"></i>
                        Admin Response
                    </h6>

                    <div class="mb-3">
                        <label for="admin_notes" class="form-label fw-semibold">Internal Notes</label>
                        <textarea class="form-control" 
                                  id="admin_notes" 
                                  name="admin_notes" 
                                  rows="5">{{ contact.admin_notes }}</textarea>
                        <small class="text-muted">These notes are for internal use only.</small>
                    </div>

                    <!-- Status Section -->
                    <h6 class="border-bottom pb-2 mb-3 mt-4">
                        <i class="fas fa-flag text-primary me-2"></i>
                        Status
                    </h6>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" 
                                       type="checkbox" 
                                       name="is_read" 
                                       id="is_read"
                                       {% if contact.is_read %}checked{% endif %}>
                                <label class="form-check-label fw-semibold" for="is_read">
                                    Mark as Read
                                </label>
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" 
                                       type="checkbox" 
                                       name="is_responded" 
                                       id="is_responded"
                                       {% if contact.is_responded %}checked{% endif %}>
                                <label class="form-check-label fw-semibold" for="is_responded">
                                    Mark as Responded
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Metadata Display -->
                    <div class="alert alert-light border mt-4">
                        <h6 class="mb-2">
                            <i class="fas fa-info-circle me-2"></i>
                            Message Metadata
                        </h6>
                        <small class="text-muted d-block">
                            <strong>Submitted:</strong> {{ contact.created_at|date:"F d, Y \a\t g:i A" }}
                        </small>
                        {% if contact.ip_address %}
                        <small class="text-muted d-block">
                            <strong>IP Address:</strong> {{ contact.ip_address }}
                        </small>
                        {% endif %}
                        {% if contact.responded_by %}
                        <small class="text-muted d-block">
                            <strong>Last Responded By:</strong> {{ contact.responded_by.get_full_name }}
                        </small>
                        {% endif %}
                    </div>

                    <!-- Form Actions -->
                    <div class="d-flex gap-2 justify-content-end mt-4 pt-3 border-top">
                        <a href="{% url 'core:admin_contact_sales_detail' contact.id %}" class="btn btn-secondary">
                            <i class="fas fa-times me-2"></i>Cancel
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i>Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<style>
.form-label {
    font-size: 0.9rem;
    color: #374151;
}

.form-control:focus {
    border-color: #087fc2;
    box-shadow: 0 0 0 0.2rem rgba(8, 127, 194, 0.25);
}

.form-check-input:checked {
    background-color: #087fc2;
    border-color: #087fc2;
}

h6 {
    font-size: 1rem;
    font-weight: 600;
    color: #1f2937;
}

.alert-light {
    background-color: #f8fafc;
}
</style>

<script>
// Auto-resize textarea
document.querySelectorAll('textarea').forEach(textarea => {
    textarea.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = this.scrollHeight + 'px';
    });
});

// Form validation
document.querySelector('form').addEventListener('submit', function(e) {
    const requiredFields = ['name', 'email', 'subject', 'message'];
    let isValid = true;

    requiredFields.forEach(field => {
        const input = document.getElementById(field);
        if (!input.value.trim()) {
            isValid = false;
            input.classList.add('is-invalid');
        } else {
            input.classList.remove('is-invalid');
        }
    });

    if (!isValid) {
        e.preventDefault();
        alert('Please fill in all required fields.');
    }
});
</script>
{% endblock %}