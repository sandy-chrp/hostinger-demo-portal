{% extends "emails/base.html" %}

{% block title %}Demo Rescheduled - {{ demo_request.demo.title }}{% endblock %}

{% block preheader %}Your demo has been rescheduled to a new date and time.{% endblock %}

{% block content %}
<!-- Reschedule Alert -->
<table width="100%" cellpadding="0" cellspacing="0" border="0" style="margin-bottom: 25px;">
    <tr>
        <td bgcolor="#fef3c7" style="background-color: #fef3c7; border-left: 4px solid #f59e0b; border-radius: 6px; padding: 18px 20px;">
            <table width="100%" cellpadding="0" cellspacing="0" border="0">
                <tr>
                    <td style="padding-right: 15px; vertical-align: top; width: 40px;">
                        <div style="width: 40px; height: 40px; background-color: #f59e0b; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <span style="color: #ffffff !important; font-size: 20px; line-height: 40px; text-align: center;">üìÖ</span>
                        </div>
                    </td>
                    <td style="vertical-align: top;">
                        <h3 style="color: #92400e !important; font-size: 16px; font-weight: 600; margin: 0 0 8px 0; mso-line-height-rule: exactly; line-height: 22px;">
                            Demo Rescheduled
                        </h3>
                        <p style="color: #78350f !important; font-size: 14px; margin: 0; mso-line-height-rule: exactly; line-height: 20px;">
                            Your demo appointment has been rescheduled to a new date and time.
                        </p>
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>

<!-- Greeting -->
<p style="color: #1e293b !important; font-size: 15px; margin: 0 0 20px 0; mso-line-height-rule: exactly; line-height: 22px;">
    Dear <strong style="color: #087fc2 !important;">{{ demo_request.user.get_full_name }}</strong>,
</p>

<p style="color: #475569 !important; font-size: 14px; margin: 0 0 25px 0; mso-line-height-rule: exactly; line-height: 21px;">
    Your demo for <strong style="color: #1e293b !important;">"{{ demo_request.demo.title }}"</strong> has been rescheduled.
</p>

<!-- Demo Details Card -->
<div style="background-color: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 20px; margin-bottom: 25px;">
    <h3 style="color: #087fc2 !important; font-size: 16px; font-weight: 600; margin: 0 0 15px 0; mso-line-height-rule: exactly; line-height: 22px;">
        üéØ Demo Information
    </h3>
    
    <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
            <td style="padding: 10px 0; border-bottom: 1px solid #e2e8f0;">
                <table width="100%" cellpadding="0" cellspacing="0" border="0">
                    <tr>
                        <td style="color: #64748b !important; font-size: 13px; width: 120px; font-weight: 500;">Demo Title:</td>
                        <td style="color: #1e293b !important; font-size: 13px; font-weight: 600;">{{ demo_request.demo.title }}</td>
                    </tr>
                </table>
            </td>
        </tr>
        {% if demo_request.demo.category %}
        <tr>
            <td style="padding: 10px 0; border-bottom: 1px solid #e2e8f0;">
                <table width="100%" cellpadding="0" cellspacing="0" border="0">
                    <tr>
                        <td style="color: #64748b !important; font-size: 13px; width: 120px; font-weight: 500;">Category:</td>
                        <td style="color: #1e293b !important; font-size: 13px; font-weight: 600;">{{ demo_request.demo.category.name }}</td>
                    </tr>
                </table>
            </td>
        </tr>
        {% endif %}
        <tr>
            <td style="padding: 10px 0;">
                <table width="100%" cellpadding="0" cellspacing="0" border="0">
                    <tr>
                        <td style="color: #64748b !important; font-size: 13px; width: 120px; font-weight: 500;">Request ID:</td>
                        <td style="color: #1e293b !important; font-size: 13px; font-weight: 600;">#{{ demo_request.id }}</td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
</div>

<!-- ‚úÖ FIXED: Schedule Comparison with Fallback Values -->
<table width="100%" cellpadding="0" cellspacing="0" border="0" style="margin-bottom: 25px;">
    <tr>
        <!-- Previous Schedule (Left Column) -->
        <td style="width: 48%; vertical-align: top; padding-right: 2%;">
            <div style="background-color: #fee2e2; border: 1px solid #fca5a5; border-radius: 8px; padding: 18px;">
                <h4 style="color: #991b1b !important; font-size: 14px; font-weight: 600; margin: 0 0 12px 0; mso-line-height-rule: exactly; line-height: 20px;">
                    ‚ùå Previous Schedule
                </h4>
                
                <table width="100%" cellpadding="0" cellspacing="0" border="0">
                    <tr>
                        <td style="padding: 8px 0;">
                            <p style="color: #7f1d1d !important; font-size: 12px; font-weight: 500; margin: 0 0 4px 0;">üìÖ Date:</p>
                            <p style="color: #991b1b !important; font-size: 14px; font-weight: 600; margin: 0;">
                                {# ‚úÖ FIXED: Use old_date if provided, fallback to demo_request values #}
                                {% if old_date %}
                                    {{ old_date }}
                                {% else %}
                                    {{ demo_request.requested_date|date:"F d, Y" }}
                                {% endif %}
                            </p>
                        </td>
                    </tr>
                    <tr>
                        <td style="padding: 8px 0;">
                            <p style="color: #7f1d1d !important; font-size: 12px; font-weight: 500; margin: 0 0 4px 0;">‚è∞ Time:</p>
                            <p style="color: #991b1b !important; font-size: 14px; font-weight: 600; margin: 0;">
                                {# ‚úÖ FIXED: Use old_time if provided, fallback to time slot method #}
                                {% if old_time %}
                                    {{ old_time }}
                                {% elif demo_request.requested_time_slot %}
                                    {{ demo_request.requested_time_slot.get_display_time }}
                                {% else %}
                                    Not specified
                                {% endif %}
                            </p>
                        </td>
                    </tr>
                </table>
            </div>
        </td>
        
        <!-- New Schedule (Right Column) -->
        <td style="width: 48%; vertical-align: top; padding-left: 2%;">
            <div style="background-color: #d1fae5; border: 1px solid #6ee7b7; border-radius: 8px; padding: 18px;">
                <h4 style="color: #065f46 !important; font-size: 14px; font-weight: 600; margin: 0 0 12px 0; mso-line-height-rule: exactly; line-height: 20px;">
                    ‚úÖ New Schedule
                </h4>
                
                <table width="100%" cellpadding="0" cellspacing="0" border="0">
                    <tr>
                        <td style="padding: 8px 0;">
                            <p style="color: #047857 !important; font-size: 12px; font-weight: 500; margin: 0 0 4px 0;">üìÖ Date:</p>
                            <p style="color: #065f46 !important; font-size: 14px; font-weight: 600; margin: 0;">
                                {# ‚úÖ FIXED: Use new_date if provided, fallback to current requested_date #}
                                {% if new_date %}
                                    {{ new_date }}
                                {% else %}
                                    {{ demo_request.requested_date|date:"F d, Y" }}
                                {% endif %}
                            </p>
                        </td>
                    </tr>
                    <tr>
                        <td style="padding: 8px 0;">
                            <p style="color: #047857 !important; font-size: 12px; font-weight: 500; margin: 0 0 4px 0;">‚è∞ Time:</p>
                            <p style="color: #065f46 !important; font-size: 14px; font-weight: 600; margin: 0;">
                                {# ‚úÖ FIXED: Use new_time if provided, fallback to time slot method #}
                                {% if new_time %}
                                    {{ new_time }}
                                {% elif demo_request.requested_time_slot %}
                                    {{ demo_request.requested_time_slot.get_display_time }}
                                {% else %}
                                    Not specified
                                {% endif %}
                            </p>
                        </td>
                    </tr>
                </table>
            </div>
        </td>
    </tr>
</table>

<!-- Reason (if provided) -->
{% if reschedule_reason %}
<div style="background-color: #f0f9ff; border: 1px solid #bae6fd; border-radius: 8px; padding: 18px; margin-bottom: 25px;">
    <h4 style="color: #0c4a6e !important; font-size: 14px; font-weight: 600; margin: 0 0 10px 0; mso-line-height-rule: exactly; line-height: 20px;">
        üìù Reason for Reschedule
    </h4>
    <p style="color: #075985 !important; font-size: 13px; margin: 0; mso-line-height-rule: exactly; line-height: 19px;">
        {{ reschedule_reason }}
    </p>
</div>
{% endif %}

<!-- Assigned Employee (if any) -->
{% if demo_request.assigned_to %}
<div style="background-color: #faf5ff; border: 1px solid #e9d5ff; border-radius: 8px; padding: 18px; margin-bottom: 25px;">
    <h4 style="color: #6b21a8 !important; font-size: 14px; font-weight: 600; margin: 0 0 10px 0; mso-line-height-rule: exactly; line-height: 20px;">
        üë§ Assigned Representative
    </h4>
    <p style="color: #7c3aed !important; font-size: 13px; margin: 0; mso-line-height-rule: exactly; line-height: 19px;">
        <strong>{{ demo_request.assigned_to.get_full_name }}</strong>
        {% if demo_request.assigned_to.email %}
        <br>
        <a href="mailto:{{ demo_request.assigned_to.email }}" style="color: #7c3aed !important; text-decoration: none;">{{ demo_request.assigned_to.email }}</a>
        {% endif %}
    </p>
</div>
{% endif %}

<!-- Important Notice -->
<table width="100%" cellpadding="0" cellspacing="0" border="0" style="margin-bottom: 25px;">
    <tr>
        <td bgcolor="#dbeafe" style="background-color: #dbeafe; border-left: 4px solid #3b82f6; border-radius: 6px; padding: 18px 20px;">
            <h4 style="color: #1e3a8a !important; font-size: 14px; font-weight: 600; margin: 0 0 8px 0; mso-line-height-rule: exactly; line-height: 20px;">
                ‚ÑπÔ∏è Important Information
            </h4>
            <p style="color: #1e40af !important; font-size: 13px; margin: 0; mso-line-height-rule: exactly; line-height: 19px;">
                Please make note of the new date and time. If you have any questions or need to make further changes, please contact our support team.
            </p>
        </td>
    </tr>
</table>

<!-- ‚úÖ OPTIONAL: CTA Button (Uncomment if demo_url is passed from backend) -->
{% comment %}
{% if demo_url %}
<div style="text-align: center; margin: 30px 0;">
    <!--[if mso]>
    <v:roundrect xmlns:v="urn:schemas-microsoft-com:vml" xmlns:w="urn:schemas-microsoft-com:office:word" href="{{ demo_url }}" style="height:48px;v-text-anchor:middle;width:200px;" arcsize="13%" strokecolor="#087fc2" fillcolor="#087fc2">
        <w:anchorlock/>
        <center style="color:#ffffff;font-family:sans-serif;font-size:15px;font-weight:bold;">View Demo Details</center>
    </v:roundrect>
    <![endif]-->
    <!--[if !mso]><!-->
    <table cellpadding="0" cellspacing="0" border="0" align="center" style="margin: 0 auto;">
        <tr>
            <td align="center" bgcolor="#087fc2" style="background-color: #087fc2; border-radius: 6px; padding: 0;">
                <a href="{{ demo_url }}" target="_blank" style="background-color: #087fc2; border: 2px solid #087fc2; border-radius: 6px; color: #ffffff !important; display: inline-block; font-family: Arial, sans-serif; font-size: 15px; font-weight: bold; line-height: 48px; text-align: center; text-decoration: none; width: 200px; -webkit-text-size-adjust: none; mso-hide: all;">
                    View Demo Details
                </a>
            </td>
        </tr>
    </table>
    <!--<![endif]-->
</div>
{% endif %}
{% endcomment %}

<!-- Contact Support -->
<div style="background-color: #fafafa; border-radius: 8px; padding: 20px; margin-top: 25px; text-align: center;">
    <h4 style="color: #087fc2 !important; font-size: 15px; font-weight: 600; margin: 0 0 12px 0; mso-line-height-rule: exactly; line-height: 21px;">
        ü§ù Need Help?
    </h4>
    <p style="color: #4b5563 !important; font-size: 13px; margin: 0 0 15px 0; mso-line-height-rule: exactly; line-height: 19px;">
        Have questions about your rescheduled demo?
    </p>
    
    <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
            <td align="center" style="padding: 6px 0;">
                <a href="mailto:reach@chrp-india.com" style="color: #087fc2 !important; font-size: 13px; font-weight: 500; text-decoration: none;">
                    üìß reach@chrp-india.com
                </a>
            </td>
        </tr>
        <tr>
            <td align="center" style="padding: 6px 0;">
                <a href="tel:+918008987948" style="color: #087fc2 !important; font-size: 13px; font-weight: 500; text-decoration: none;">
                    üìû +91-8008987948
                </a>
            </td>
        </tr>
    </table>
</div>

<!-- Closing -->
<div style="text-align: left; margin-top: 30px; padding-top: 20px; border-top: 1px solid #e5e7eb;">
    <p style="color: #475569 !important; font-size: 14px; margin: 0 0 10px 0; mso-line-height-rule: exactly; line-height: 20px;">
        Best regards,
    </p>
    <p style="color: #1e293b !important; font-size: 14px; font-weight: 600; margin: 0; mso-line-height-rule: exactly; line-height: 20px;">
        Demo Management Team<br>
        <span style="color: #087fc2 !important;">CHRP India</span>
    </p>
</div>
{% endblock %}

{% block footer_text %}
You received this email because your demo appointment was rescheduled on Demo Portal by CHRP India.
{% endblock %}